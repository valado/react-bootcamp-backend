{"code":"!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=6)}([function(e,t){e.exports=require(\"express\")},function(e,t){e.exports=require(\"helmet\")},function(e,t){e.exports=require(\"uuid/v4\")},function(e,t){e.exports=require(\"body-parser\")},function(e,t){e.exports=require(\"cors\")},function(e,t){e.exports=require(\"email-validator\")},function(e,t,n){\"use strict\";n.r(t);var r=n(2),o={},s={},u=function(e){return o.hasOwnProperty(e)},i=function(e){return s.hasOwnProperty(e)},a=n(1),l=n.n(a),c=n(0),d=n(5),p=function(e){return console.log(e),e.hasOwnProperty(\"authorization\")?e.authorization:null},f=function(e){e=e.replace(\"Basic \",\"\"),console.log(e);var t=e.split(\":\");if(2!==t.length)return null;var n=t[0],r=t[1];return d.validate(n)?{email:n,password:r}:null},v=Object(c.Router)();v.post(\"/\",function(e,t){console.log(\"login\");var n=p(e.headers);if(console.log(n),!n)return t.status(400),t.send(\"Invalid Authorization header!\");var r=f(n);if(console.log(r),!r)return t.status(400),t.send(\"Invalid Authorization header!\");console.log(r);var s,i,a=(s=r.email,i=r.password,u(s)?o[s]&&o[s].password===i?{success:!0,token:o[s].token}:{success:!1,error:\"Invalid password!\"}:{success:!1,error:\"Invalid email!\"});return a.success?t.status(200).cookie(\"token\",a.token,{httpOnly:!0}).send():t.status(401).send({error:a.error})});var g=v,y=Object(c.Router)();y.post(\"/\",function(e,t){console.log(\"register\");var n=p(e.headers);if(!n)return t.status(400),void t.send(\"Invalid Authorization header!\");var i,a,l,c=f(n);return c?(console.log(c),u(c.email)?(t.status(400),t.send(\"Email is already taken!\")):(i=c.email,a=c.password,l=r(),o[i]={password:a,token:l},s[l]={},t.status(200),t.send())):(t.status(400),void t.send(\"Invalid Credentials!\"))});var h=y,b=Object(c.Router)();b.post(\"/\",function(e,t){var n=e.token;return console.log(n),console.log(e.body),function(e,t){s[e]=t}(n,e.body),t.status(200),t.send()}),b.get(\"/\",function(e,t){var n=e.token;console.log(n);var r=function(e){return i(e)?s[e]:null}(n);return r?(t.setHeader(\"Content-Type\",\"application/json\"),t.json(r)):(t.status(500),t.send(\"Server error!\"))});var O=b,m=n(0),j=n(3),k=n(4),x=m();x.use(l()()),x.use(j.json({extended:!0}));x.use(k({origin:\"*\",preflightContinue:!1,credentials:!0,methods:[\"OPTIONS\",\"GET\",\"PUT\",\"POST\",\"DELETE\"],allowedHeaders:[\"Content-Type\",\"Authorization\"]})),x.use(\"/register\",h),x.use(\"/login\",g),x.delete(\"/db\",function(e,t){o={},s={},t.send()}),x.use(function(e,t,n){var r=e.cookies.token;return r?i(r)?(e.token=r,n()):(t.status(401),void t.send(\"Not authorized!\")):(t.status(400),void t.send(\"Invalid Token!\"))}),x.use(\"/data\",O),x.set(\"port\",process.env.PORT||9e3),x.listen(x.get(\"port\"),function(){console.log(\"Node app is running on port\",x.get(\"port\"))})}]);","extractedComments":[]}